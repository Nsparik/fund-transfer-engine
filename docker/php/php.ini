; ═══════════════════════════════════════════════════════════════════════════════
; Fund Transfer Engine — PHP Runtime Configuration
; Loaded as 99-app.ini (last loaded, overrides all distro defaults)
; ═══════════════════════════════════════════════════════════════════════════════

; ─── Timezone ─────────────────────────────────────────────────────────────────
; UTC everywhere — prevents timestamp drift between PHP, MySQL, and Redis.
; Financial timestamps must be timezone-unambiguous.
date.timezone = UTC

; ─── Error Handling ───────────────────────────────────────────────────────────
; Never expose PHP errors to HTTP clients (information leakage risk).
; Errors go to stderr → captured by `docker compose logs php`
display_errors         = Off
display_startup_errors = Off
log_errors             = On
error_log              = /proc/self/fd/2
error_reporting        = E_ALL

; ─── Security ─────────────────────────────────────────────────────────────────
; Do not reveal PHP version in HTTP response headers (X-Powered-By)
expose_php = Off

; Restricts dangerous functions for the web request context.
; NOTE: In dev, this php.ini is shared between FPM workers AND CLI (composer, bin/console).
; We keep only truly exploitable functions disabled that have zero dev use:
;   parse_ini_file : reads arbitrary files, no legitimate app use
;   show_source    : exposes PHP source code via HTTP
; Functions like exec/proc_open/shell_exec are needed by Composer and Symfony CLI tools in dev.
; In production containers, Composer is NEVER present — disable_functions can be
; re-tightened via a prod-specific php.ini overlay (config/php.ini-prod).
disable_functions = parse_ini_file,show_source

; ─── Resource Limits ──────────────────────────────────────────────────────────
memory_limit          = 256M
max_execution_time    = 30
post_max_size         = 2M
upload_max_filesize   = 2M

; ─── OPcache ──────────────────────────────────────────────────────────────────
opcache.enable                = 1
opcache.memory_consumption    = 128
opcache.max_accelerated_files = 10000
opcache.revalidate_freq       = 0
; Controlled via env var:
;   dev  → 1 (revalidate on every request — files change via volume mount)
;   prod → 0 (immutable container image, never revalidate)
opcache.validate_timestamps   = ${PHP_OPCACHE_VALIDATE_TIMESTAMPS}
