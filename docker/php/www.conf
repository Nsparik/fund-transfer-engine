; ═══════════════════════════════════════════════════════════════════════════════
; PHP-FPM Pool — www
; ═══════════════════════════════════════════════════════════════════════════════

[www]

; ─── Worker User ──────────────────────────────────────────────────────────────
; FPM master (root) forks and drops to appuser for ALL PHP code execution.
user  = appuser
group = appuser

; ─── Socket ───────────────────────────────────────────────────────────────────
; TCP socket — Apache proxies to php-fpm:9000 over the fund_internal network
listen = 0.0.0.0:9000

; ─── Process Manager ──────────────────────────────────────────────────────────
pm                   = dynamic
pm.max_children      = 10
pm.start_servers     = 2
pm.min_spare_servers = 1
pm.max_spare_servers = 3
; Recycle workers after N requests to prevent slow memory leaks
pm.max_requests      = 500

; ─── Logging ──────────────────────────────────────────────────────────────────
php_admin_flag[log_errors] = on
php_admin_value[error_log] = /proc/self/fd/2
access.log                 = /proc/self/fd/2
access.format              = "%R - %u %t \"%m %r\" %s %l %Q %f"

; ─── Environment ──────────────────────────────────────────────────────────────
; Workers need APP_ENV, DATABASE_URL, REDIS_URL injected from container env
clear_env = no
